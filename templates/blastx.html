{% extends 'base.html' %}

{% block title %}Blastx{% endblock %}

{% block content %}
    <div class="row">
        <div class="page-header">
            <h3>Blastx<small>Subtext for header</small></h3>

        </div>
    </div>
<h1> Introduction to <span style="color:#000BFF"> BLASTX </span> service on dbCAN-PUL database.</h1>

<p> We have curated 602 CAZyme-containing gene clusters that have been experimentally validated to act on a carbohydrate substrate. Here, we provide an integrated BLASTX service to find homologous genes and gene clusters in dbCAN-PUL and infer a putative substrate with your <span style="color:red"> DNA sequences </span>.If you would like to predict CAZyme-containing gene clusters with protein sequences, please use our <a href="http://bcb.unl.edu/dbCAN2/blast.php"> dbCAN2 </a> service with CGCFinder. Click <a href="#">here </a> to view an example BLASTX result page. </p>
        <div class="container">
  <form action="/action_page.php">

    <label for="subject">Subject</label>

    <input type="submit" value="Submit">
  </form>             
                     <form class="ui form" method="POST" enctype="multipart/form-data" style="text-align:center" action="run_blast">
                         {{ form.hidden_tag() }}
                         <div style="text-align:left;">
	<span style="color:blue"> <b> I. Paste the sequence in the textarea. </b> </span> <br>
<span style="font-size:1em;">Try <a id="id_example" href="#" style="color:blue;" value="protein"> example </a> sequences.</span>
</div>

                      {{ form.recaptcha(class="form-control") }}
                      {{ form.submit(class="form-control") }}
                     </form>
                     
                     
                     
                     
                     <script type="text/javascript">
	function validatePaste(){
	var text = document.getElementById("id_sequences").value;
	var v = document.getElementById("id_sequences");
	var seqs = text.split(">"); 
	//split by sequence
	if(seqs.length < 2){      //no > existed
		alert("Pasted sequence is not in FASTA format. No headers found.");
		v.value = "";
		return false;
	}
	if(seqs[0].length == 0){ //first array should be empty
		seqs.shift();
	}else{                   //there was stuff before first >
		alert("Pasted sequence is not in FASTA format. There should be no data above the first header.");
		v.value = "";
		return false;
	}
	for(var i = 0; i < seqs.length; i++){  //split each sequence by line
		seqs[i] = seqs[i].match(/[^\r\n]+/g);
		if(seqs[i].length < 2){            //every sequence must be at least 2 lines (header and AA/NA)
			alert("Pasted sequence is not in FASTA format. No data found under header line.");
			v.value = "";
			return false;
		}
	}
	prot = false;
	for(var i = 0; i < seqs.length; i++){
		for(var j = 1; j < seqs[i].length; j++){
				if(seqs[i][j].search(/[BDEFHIJKLMOPQRSUVWXYZ0123456789\s]/i) != -1)
				{
					alert("Illegal characters found in sequences. Nucleotides sequences can only contain A, T, C, G, or N characters.");
					v.value = "";
					return false;
				}
			}
		}
	return true;
	}
// the end of the first funciton

function validateFasta(files){
	var validFasta = true;
	var f = document.getElementById("id_file");
	var file = files[0];
	if(file.size/1024/1024 > 20){
		alert("Max file size is 20 MB. Please upload a smaller file.");
		f.value = "";
		return;
	}
	// for file size 
	var reader = new FileReader();
	reader.onload = function(e){
		var text = reader.result;
		var seqs = text.split(">"); //split by sequence
		if(seqs.length < 2){      //no > existed
			validFasta = false;	
			alert("File is not in FASTA format.");
			f.value = "";
			return;
		}
		if(seqs[0].length == 0){ //first array should be empty
			seqs.shift();
		}else{                   //there was stuff before first >
			validFasta = false;
			alert("File is not in FASTA format. There should be no data above the first header.");
			f.value = "";
			return;
		}
		for(var i = 0; i < seqs.length; i++){  //split each sequence by line
			seqs[i] = seqs[i].match(/[^\r\n]+/g);
			if(seqs[i].length < 2){            //every sequence must be at least 2 lines (header and AA/NA)
				validFasta = false;
				alert("File is not in FASTA format.");
				f.value = "";
				return;
			}
		}
		prot = false;
		for(var i = 0; i < seqs.length; i++){
			for(var j = 1; j < seqs[i].length; j++){
				if(seqs[i][j].search(/[BDEFHIJKLMOPQRSUVWXYZ0123456789\s]/i) != -1){
						//if(seqs[i][j].search(/[BDEFHIJKLMNOPQRSUVWXYZ0123456789\s]/i) != -1){
						validFasta = false;
						document.getElementById("file_spinner").hidden = true;
						alert("Illegal characters found in sequences. Nucleotides sequences can only contain A, T, C, G, or N characters.");
						f.value = "";
						return;
					}
				}
			}
	}
	reader.readAsText(file);
	return validFasta;
	// justy the file is not in FASTA format

}
</script>

<style>
body {font-family: Arial, Helvetica, sans-serif;}
* {box-sizing: border-box;}

input[type=text], select, textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}

input[type=submit] {
  background-color: #4CAF50;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

.container {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>
{% endblock %}